# Example production values for dev-toolchain
# Copy this file and customize for your needs

global:
  imageRegistry: ghcr.io
  imagePullPolicy: Always
  imagePullSecrets: []
  # Example with private registry:
  # imagePullSecrets:
  #   - name: ghcr-secret

toolchains:
  # Developer 1's toolchain
  alice:
    enabled: true
    hostname: tch-alice
    image: repotea-workspace/kangumi/dev-toolchain:latest

    # SSH Configuration
    # Mix of inline content and external secret references
    sshConfig:
      root:
        # Public keys - safe to store inline
        authorized_keys: |
          ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIHcGLAMw4CU5Ugv/HTl2iskVOKp0ew/DAhAfTJ+8nDBk alice@laptop
          ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAneSmM1VlnYEI2iLApYFQmzLt8hxAT9r2UgbgW/JdnC alice@desktop

        # Private key - reference external secret (recommended)
        # Create secret first: kubectl create secret generic ssh-private-keys --from-file=alice_id_ed25519=~/.ssh/id_ed25519 -n production
        id_ed25519:
          secretRef:
            name: ssh-private-keys
            key: alice_id_ed25519

        # Public key - inline is fine
        id_ed25519.pub: |
          ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIHcGLAMw4CU5Ugv/HTl2iskVOKp0ew/DAhAfTJ+8nDBk alice@tch-alice

        # Known hosts - can use either inline or secretRef
        known_hosts: |
          github.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOMqqnkVzrm0SdG6UOoqKLsabgH5C9okWi0dh2l9GKJl
          gitlab.com ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIAfuCHKVTjquxvt6CM6tdG4SLp1Btn/nOeHHE5UOzRdf

        # SSH client config
        config: |
          Host github.com
            IdentityFile ~/.ssh/id_ed25519
            StrictHostKeyChecking no

          Host gitlab.com
            IdentityFile ~/.ssh/id_ed25519
            StrictHostKeyChecking no

      # Optional: Configure SSH for other users
      linuxbrew:
        authorized_keys: |
          ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJmKL... linuxbrew@alice
        id_ed25519:
          secretRef:
            name: ssh-private-keys
            key: linuxbrew_id_ed25519
        id_ed25519.pub: |
          ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJmKL... linuxbrew@tch-alice

    # Auto-install development tools on first startup
    devTools:
      autoInstall: true

      # Tools to install via Homebrew
      packages:
        - golang
        - nodejs
        - k8s-tools
        - docker-compose

    ports:
      ssh:
        containerPort: 22
        nodePort: 17000
      extra:
        - name: http
          containerPort: 8080
          nodePort: 17100
        - name: https
          containerPort: 8443
          nodePort: 17101

    storage:
      pvc:
        enabled: true
        name: tch-alice-data
        size: 200Gi
        storageClassName: ""
        accessMode: ReadWriteOnce

      # Mount specific directories from PVC
      volumes:
        root:
          mountPath: /root
          subPath: home/root
        home:
          mountPath: /home
          subPath: home/users
        data:
          mountPath: /data
          subPath: workspace/data
        code:
          mountPath: /code
          subPath: workspace/code

      # Optional shared storage
      sharedPVC:
        enabled: true
        name: dev-shared-wwwroot
        size: 50Gi
        accessMode: ReadWriteMany
        mountPath: /data/wwwroot

    dind:
      enabled: true
      image: docker:29-dind
      storage:
        type: emptyDir

    resources:
      limits:
        cpu: "8"
        memory: 32Gi
      requests:
        cpu: "2"
        memory: 4Gi

    env:
      - name: TZ
        value: Asia/Shanghai
      - name: LANG
        value: en_US.UTF-8

  # Developer 2's toolchain
  bob:
    enabled: true
    hostname: tch-bob
    image: repotea-workspace/kangumi/dev-toolchain:latest

    # SSH Configuration - simpler example with just authorized_keys
    sshConfig:
      root:
        authorized_keys: |
          ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIKjdL... bob@laptop
          ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAAB... bob@desktop

    # Auto-install development tools on first startup
    devTools:
      autoInstall: true
      packages:
        - nodejs
        - rust
        # - flutter
        # - java
        # - all  # Install all available tools

    ports:
      ssh:
        containerPort: 22
        nodePort: 17001
      extra:
        - name: web
          containerPort: 3000
          nodePort: 17102

    storage:
      pvc:
        enabled: true
        name: tch-bob-data
        size: 150Gi

      volumes:
        root:
          mountPath: /root
          subPath: home/root
        code:
          mountPath: /code
          subPath: workspace/code

      sharedPVC:
        enabled: true
        name: dev-shared-wwwroot
        mountPath: /data/wwwroot

    dind:
      enabled: true

    resources:
      limits:
        cpu: "4"
        memory: 16Gi
      requests:
        cpu: "1"
        memory: 2Gi

# DinD defaults
dindDefaults:
  image: docker:29-dind
  pullPolicy: IfNotPresent
  env:
    DOCKER_TLS_CERTDIR: ""
  resources:
    limits:
      cpu: "4"
      memory: 8Gi
    requests:
      cpu: "1"
      memory: 2Gi
